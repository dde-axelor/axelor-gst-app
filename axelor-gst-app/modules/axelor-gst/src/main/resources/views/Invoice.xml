<?xml version="1.0" encoding="UTF-8"?>
<object-views xmlns="http://axelor.com/xml/ns/object-views" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="http://axelor.com/xml/ns/object-views http://axelor.com/xml/ns/object-views/object-views_5.4.xsd">
  
  <selection name="select-invoice-status">
  	<option value="draft">Draft</option>
  	<option value="validated">Validated</option>
  	<option value="paid">Paid</option>
  	<option value="cancelled">Cancelled</option>
  </selection>
  
  <grid model="com.axelor.gst.app.Invoice" title="Invoices" name="invoice-grid">
  	<field name="status"/>
  	<field name="company"/>
  	<field name="reference"/>
  	<field name="invoiceDate"/>
  	<field name="priority"/>
  	<field name="party"/>
  	<field name="partyContact"/>
  	<field name="invoiceAddress"/>
  	<field name="shippingAddress"/>
  	<field name="useInvoiceAddressAsShipping"/>
  	<field name="netAmount"/>
  	<field name="netIgst" />
  	<field name="netCgst" />
  	<field name="netSgst" />
  	<field name="grossAmount" />
  	<field name="invoiceItem"/>
  </grid>
  
  <form model="com.axelor.gst.app.Invoice" title="Invoices" name="invoice-form" onNew="action-group-on-new-from,action-group-for-change-amounts"  onSave="action-method-set-invoice-net-amounts">
  	<toolbar>
  		<button onClick="action-print-invoice" name="printInvoice" icon="fa-print"/>
  	</toolbar>
  	<panel sidebar="true">
  		<button onClick="save,action-record-change-status-draft,save" name="dratftBtn" title="Return To Draft" icon="fa-retweet" hideIf="status==&quot;draft&quot; || status==&quot;validated&quot; || status==&quot;paid&quot;"/>
  		<button onClick="save,action-record-change-record-status-validated,action-invoice-method-set-reference,save" name="validateBtn" title="Validate" icon="fa-paper-plane" hideIf="status==&quot;validated&quot; || status==&quot;paid&quot; || status==&quot;cancelled&quot;"/>
  		<button onClick="save,action-record-change-status-paid,save" name="paidBtn" title="Paid" css="btn btn-success" icon="fa-check-square-o" hideIf="status==&quot;paid&quot; || status==&quot;draft&quot; || status==&quot;cancelled&quot;"/>
  		<button onClick="save,action-record-change-status-cancel,save" name="cancelBtn" title="Cancel" icon="fa-times" css="btn btn-danger" hideIf="status==&quot;cancelled&quot;"/>
  	</panel>
  	<panel title="Invoice">
  		<field name="status" readonly="true" widget="NavSelect" colSpan="8"/>
  		<field name="company" onChange="action-group-for-change-amounts"/>
  		<field name="reference"/>
  		<field name="invoiceDate"/>
  		<field name="priority"/>
  		<field name="party" onChange="action-method-set-contact,action-group-for-change-amounts"/>
  		<field name="partyContact" domain="self.party=:party" onChange="action-method-change-amounts-on-change,action-method-set-invoice-net-amounts"/>
  		<field name="invoiceAddress" domain="self.party=:party" onChange="action-group-for-change-amounts"/>
  		<field name="shippingAddress" domain="self.party=:party"/>
  		<field name="useInvoiceAddressAsShipping" onChange="action-attr-check-value"/>
  		<field name="netAmount" readonly="true"/>
  		<field name="netIgst" readonly="true"/>
  		<field name="netCgst" readonly="true"/>
  		<field name="netSgst" readonly="true"/>
  		<field name="grossAmount" readonly="true"/> 		
  	</panel>
  	<panel-related field="invoiceItem" onChange="action-method-set-invoice-net-amounts"/>
  </form>
  
  <kanban columnBy="status" model="com.axelor.gst.app.Invoice" sequenceBy="priority" title="Invoices" name="invoice-kanban">
  	<field name="company"/>
  	<field name="party"/>
  	<template>
  		<![CDATA[
  			<div style="text-align:center;">
  				Company: {{company.name}}<br>
  				Party: {{party.name}}
  			</div>
  		]]>
  	</template>
  </kanban>
  
  
  
  <action-method name="action-method-set-values-from-product">
  	<call class="com.axelor.gst.controller.InvoiceController" method="setInvoiceItem"/>
  </action-method>
  
  <action-attrs name="action-attr-check-null-values">
  	<attribute name="readonly" for="invoiceItem" expr="true" if="invoiceAddress==null || company==null"/>
  	<attribute name="readonly" for="invoiceItem" expr="false" if="invoiceAddress!=null &amp;&amp; company!=null"/>
  </action-attrs>
  
  <action-attrs name="action-attr-set-party-contact">
  	<attribute name="value" for="partyContact" expr="eval:party.contact"/>
  </action-attrs>
  
  <action-attrs name="action-attr-set-default-value">
  	<attribute name="value" for="invoiceDate" expr="eval:__datetime__"/>
  	<attribute name="value" for="company" expr="eval:__repo__(Company).all().fetchOne()"/>
  </action-attrs>
  
  <action-attrs name="action-attr-check-value">
  	<attribute name="hidden" for="shippingAddress" expr="eval:__this__.invoiceAddress" if="useInvoiceAddressAsShipping"/>
  	<attribute name="value" for="shippingAddress" expr="eval:__this__.invoiceAddress" if="useInvoiceAddressAsShipping"/>
  </action-attrs>
  
  <action-record name="action-record-change-status-draft" model="com.axelor.gst.app.Invoice">
  	<field name="status" expr="draft"/>
  </action-record>
  
  <action-record name="action-record-change-record-status-validated" model="com.axelor.gst.app.Invoice">
  	<field name="status" expr="validated"/>
  </action-record>
  
  <action-record name="action-record-change-status-paid" model="com.axelor.gst.app.Invoice">
  	<field name="status" expr="paid"/>
  </action-record>
  
  <action-record name="action-record-change-status-cancel" model="com.axelor.gst.app.Invoice">
  	<field name="status" expr="cancelled"/>
  </action-record>
  
  <action-method name="action-method-set-gst-values-to-zero">
  	<call class="com.axelor.gst.controller.InvoiceController" method="setGst" />
  </action-method>
  
 <action-method name="action-method-set-contact">
   <call class="com.axelor.gst.controller.InvoiceController" method="setContact"/>
  </action-method>
  
  
  <action-method name="action-invoice-method-set-reference">
  	<call class="com.axelor.gst.controller.InvoiceController" method="setInvoiceReference" if="__self__.reference==null"/>
  </action-method>

  
  <action-method name="action-method-set-invoice-net-amounts">
  	<call class="com.axelor.gst.controller.InvoiceController" method="setAmounts"/>
  </action-method>
  
  <action-method name="action-method-change-amounts-on-change">
  	<call class="com.axelor.gst.controller.InvoiceController" method="setValuesOnChange"/>
  </action-method>
  
  <action-group name="action-group-on-new-from">
  	<action name="action-attr-set-default-value"/>
  	<action name="action-method-set-values-from-product"  if="productId!=null"/>
  	<action name="action-attr-check-null-values"/>
  </action-group>
  
  <action-group name="action-group-for-change-amounts">
  	<action name="action-attr-check-null-values" />
  	<action name="action-method-set-gst-values-to-zero"/>
  	<action name="action-method-change-amounts-on-change"/>
  	<action name="action-method-set-invoice-net-amounts"/>
  </action-group>
  
  <action-report output="invoice-${date}${time}" name="action-print-invoice" design="invoice.rptdesign" format="pdf">
  	<param name="companyId" expr="eval:company.id"/>
  	<param name="invoiceId" expr="eval:id"/>
  	<param name="partyId" expr="eval:party.id"/>
  	<param name="addressId" expr="eval:invoiceAddress.id"/>
  	<param name="logoUrl" expr="call:com.axelor.gst.controller.InvoiceController:getLogoUrl()"/>
  </action-report>
 </object-views>